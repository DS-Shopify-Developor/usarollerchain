{% comment %}
  Renders facets (filtering and sorting)

  Accepts:
  - results: {Object} Collection or Search object
  - enable_filtering: {Boolean} Show filtering when true
  - enable_sorting: {Boolean} Show sorting when true
  - filter_type: {String} Type of filter
  - paginate: {Object}

  Usage:
  {% render 'facets', results: collection, enable_filtering: true, enable_sorting: true, filter_type: 'vertical', paginate: paginate %}
{% endcomment %}

{{ 'component-show-more.css' | asset_url | stylesheet_tag }}
{{ 'component-visual-display.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign sort_by = results.sort_by | default: results.default_sort_by
  assign total_active_values = 0
  if results.url
    assign results_url = results.url
  else
    assign terms = results.terms | escape
    assign results_url = '?q=' | append: terms | append: '&options%5Bprefix%5D=last&sort_by=' | append: sort_by
  endif
-%}


<div class="facets-container{%- if enable_filtering and enable_sorting -%} facets-both-filter{%- endif -%}{% if filter_type == 'drawer' %} facets-container-drawer{% endif %}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--fade-in{% endif %}">
  {%- if filter_type == 'vertical' or filter_type == 'horizontal' -%}
    <facet-filters-form class="facets small-hide block__facets">
      <form
        id="FacetFiltersForm"
        class="{% if filter_type == 'horizontal' %}facets__form{% else %}facets__form-vertical{% endif %}"
      >


        {%- if results.terms -%}
          <input type="hidden" name="q" value="{{ results.terms | escape }}">
          <input name="options[prefix]" type="hidden" value="last">
        {%- endif -%}

        {% if enable_filtering %}
          {% comment %} Heading is the first tabbable element on filter type horizontal {% endcomment %}
         
         
          <div
            id="FacetsWrapperDesktop"
            {% if filter_type == 'horizontal' %}
              class="facets__wrapper"
            {% endif %}
          >
        
          
            {%- if filter_type == 'horizontal' and results.filters != empty -%}
              <h2 class="facets__heading caption-large text-body" id="verticalTitle" tabindex="-1">
                {{ 'products.facets.filter_by_label' | t }}
              </h2>
            {%- endif -%}
            {% comment %} Pills are right below the title for filter type vertical {% endcomment %}
            {%- if filter_type == 'vertical' -%}
              <div class="active-facets active-facets-desktop">
                <div class="active-facets-vertical-filter">
                  {% comment %} {%- unless results.filters == empty -%} {% endcomment %}
                    <h2
                      class="facets__heading facets__heading--vertical caption-large text-body"
                      id="verticalTitle"
                      tabindex="-1"
                    >
                      {{ 'products.facets.filter_by_label' | t }}
                    </h2>
                  {% comment %} {%- endunless -%} {% endcomment %}
                  <facet-remove class="active-facets__button-wrapper">
                    <a href="{{ results_url }}" class="active-facets__button-remove underlined-link">
                      <span>{{ 'products.facets.clear_all' | t }}</span>
                    </a>
                  </facet-remove>
                </div>
                {%- for filter in results.filters -%}
                  {%- for value in filter.active_values -%}
                    <facet-remove>
                      <a href="{{ value.url_to_remove }}" class="active-facets__button active-facets__button--light">
                        <span class="active-facets__button-inner button button--tertiary">
                          {{ filter.label | escape }}: {{ value.label | escape }}
                          {% render 'icon-close-small' %}
                          <span class="visually-hidden">{{ 'products.facets.clear_filter' | t }}</span>
                        </span>
                      </a>
                    </facet-remove>
                  {%- endfor -%}
                  {% if filter.type == 'price_range' %}
                    {%- if filter.min_value.value != null or filter.max_value.value != null -%}
                      <facet-remove>
                        <a href="{{ filter.url_to_remove }}" class="active-facets__button active-facets__button--light">
                          <span class="active-facets__button-inner button button--tertiary">
                            {%- if filter.min_value.value -%}
                              {{ filter.min_value.value | money }}
                            {%- else -%}
                              {{ 0 | money }}
                            {%- endif -%}
                            -
                            {%- if filter.max_value.value -%}
                              {{ filter.max_value.value | money }}
                            {%- else -%}
                              {{ filter.range_max | money }}
                            {%- endif -%}
                            {% render 'icon-close-small' %}
                            <span class="visually-hidden">{{ 'products.facets.clear_filter' | t }}</span>
                          </span>
                        </a>
                      </facet-remove>
                    {%- endif -%}
                  {% endif %}
                {%- endfor -%}
              </div>
            {%- endif -%}

            <script src="{{ 'show-more.js' | asset_url }}" defer="defer"></script>
            {% comment %} Filters for both horizontal and vertical filter {% endcomment %}
             

            
            {%- for filter in results.filters -%}
              {% liquid
                assign total_active_values = total_active_values | plus: filter.active_values.size
                case filter.presentation
                  when 'swatch'
                    assign has_visual_display = true
                    assign show_more_number = 15
                    assign visual_layout_class = 'facets-layout-grid facets-layout-grid--' | append: filter.presentation
                  else
                    assign has_visual_display = false
                    assign visual_layout_class = 'facets-layout-list'
                    assign show_more_number = 10
                endcase
              %}
                            
              {% case filter.type %}
                {% when 'boolean', 'list' %}

                      {% assign filter_paramval = filter.param_name | handle %}
                         {% if filter_paramval == 'filter-p-tag' or filter_paramval == 'filter-p-tags' %}
                          {%- assign custom_filter_labels = section.settings.filter_custom_labels | split: ','   -%}
                          
                          {% for label in custom_filter_labels %}
                            {% comment %} {% assign label_handle = label | handle   %} {% endcomment %}

                            {%- assign current_count = 0 -%} 
                            {%- for value in filter.values -%}
                              {% assign filterval = value.value |  handleize  %}
                              {% assign label_handle = label | strip  | handleize  %}
                           
                              {% if filterval contains label_handle %}
                                {% comment %} {{ filterval }}kkfilterval <br>
                                {{ label_handle  }}kklabel <br> {% endcomment %}
                                {% assign current_count = current_count | plus: 1  %}
                              {% endif %}
                            {% endfor %}
                            {% comment %} Tag base Filter Show {% endcomment %}


                            {% if current_count > 0 %}
                              {% if  filterval != blank %}
                                <details
                                  id="Details-{{ filter.param_name | escape }}-{{ section.id }}-{{ label | handle }}"
                                  class="{% if filter_type == 'horizontal' %}disclosure-has-popup facets__disclosure{% else %} facets__disclosure-vertical{% endif %}  filter2_{{ label | handle }} js-filter"
                                  data-index="{{ forloop.index }}-{{ label | handle }}"
                                  >
                                    <summary
                                      class="facets__summary caption-large focus-offset"
                                      aria-label="{{ label | strip }} ({{ 'products.facets.filters_selected.one' | t: count: filter.active_values.size }})"
                                    >
                                      <div>
                                        <span class="facets__summary-label">
                                          {{ label | split: '_' | last | escape }}
                                        </span>
                                        {%- if filter_type == 'vertical' and filter.operator == 'AND' -%}
                                          <span class="facets__and-helptext">
                                            {{ 'products.facets.filter_and_operator_subtitle' | t }}
                                          </span>
                                        {%- endif -%}
                                        <span class="facets__summary_icon facets_summary_iconplus">{% render 'icon-filter-plus' %}</span>
                                        <span class="facets__summary_icon facets_summary_iconminus">{% render 'icon-filter-minus' %}</span>
                                      </div>
                                    </summary>
                                    <div
                                    id="Facet-{{ forloop.index }}-{{ section.id }}"
                                    class="parent-display {% if filter_type == 'horizontal' %}facets__display{% else %}facets__display-vertical{% endif %}"
                                    >
                                      {%- if filter_type != 'vertical' -%}
                                        <div class="facets__header">
                                          <div>
                                            <span class="facets__selected no-js-hidden">
                                              {{- 'products.facets.filters_selected' | t: count: filter.active_values.size -}}
                                            </span>
                                            {%- if filter.operator == 'AND' -%}
                                              <span class="facets__and-helptext">
                                                {{ 'products.facets.filter_and_operator_subtitle' | t }}
                                              </span>
                                            {%- endif -%}
                                          </div>
                                          <facet-remove>
                                            <a href="{{ filter.url_to_remove }}" class="facets__reset link underlined-link">
                                              {{ 'products.facets.reset' | t }}
                                            </a>
                                          </facet-remove>
                                        </div>
                                      {%- endif -%}
    
                                      <fieldset class="facets-wrap parent-wrap {% if filter_type == 'vertical' %} facets-wrap-vertical{% endif %}">
                                        <legend class="visually-hidden">{{ filter.label | escape }}</legend>
                                        <ul
                                          class="{{ visual_layout_class }}{% if filter_type == 'vertical' %} facets__list--vertical{% else %} facets__list{% endif %} list-unstyled no-js-hidden"
                                          role="list"
                                        >
                                          {%- liquid
                                            assign sorted_values = filter.values
                                            # Keep the selected values grouped together when operator is AND
                                            if filter.operator == 'AND'
                                              assign active_filter_values = filter.values | where: 'active', true
                                              assign inactive_filter_values = filter.values | where: 'active', false
                                              assign sorted_values = active_filter_values | concat: inactive_filter_values
                                            endif
                                          -%}
                                          {% assign current_count-tag = 0 %}
                                          {%- for value in sorted_values -%}
                                            {% liquid
                                              assign is_disabled = false
                                              if value.count == 0 and value.active == false
                                                assign is_disabled = true
                                              endif
                                            %}
                                            {% comment %} {% assign filterval = value.value %} {% endcomment %}
    
                                      
                                            {% comment %} {% if filterval contains 'Chain Size_' or filterval contains 'chain size_' %}
                                              {% assign chain_size_count = chain_size_count | plus: 1 %} {% endcomment %}
                                              {% comment %} {% assign filterval = value.value %} {% endcomment %}
                                              {% assign filterval = value.value |  handleize  %}
                                              {% assign label_handle = label | strip  | handleize  %}
                                              {% if filterval contains label_handle  %}
                                                {% comment %} {{ filterval }}--filterval
                                                {{ label  }}--label {% endcomment %}

                                                {% assign current_count-tag = current_count-tag | plus: 1 %}
                                            <li class="list-menu__item facets__item k-{{current_count1}} {% if current_count-tag > 10 %} show-more-item hidden{% endif %} ">
                                              <label
                                                for="Filter-{{ filter.param_name | escape }}-{{ forloop.index }}"
                                                class="facets__label facet-checkbox{% if is_disabled %} facet-checkbox--disabled disabled{% endif %}{% if has_visual_display %} visual-display-parent visual-display-parent--{{ filter.presentation }}{% endif %}{% if value.active %} active{% endif %}"
                                              >
                                                <input
                                                  type="checkbox"
                                                  name="{{ value.param_name }}"
                                                  value="{{ value.value }}"
                                                  id="Filter-{{ filter.param_name | escape }}-{{ forloop.index }}"
                                                  {% if value.active %}
                                                    checked
                                                  {% endif %}
                                                  {% if is_disabled %}
                                                    disabled
                                                  {% endif %}
                                                >
                
                                                {% if has_visual_display %}
                                                  <div class="facets__visual-display-wrapper">
                                                    {% render 'visual-display',
                                                      type: value.display.type,
                                                      value: value.display.value,
                                                      presentation: filter.presentation
                                                    %}
                                                  </div>
                                                {% else %}
                                                  <svg
                                                    width="1.6rem"
                                                    height="1.6rem"
                                                    viewBox="0 0 14 14"
                                                    aria-hidden="true"
                                                    focusable="false"
                                                    class="checkbox_input_svg"
                                                  >
                                                    <rect width="14" height="14" stroke="currentColor" fill="none" stroke-width="1"></rect>
                                                  </svg>
                
                                                  <svg
                                                    aria-hidden="true"
                                                    class="icon icon-checkmark"
                                                    width="1.1rem"
                                                    height="0.7rem"
                                                    viewBox="0 0 11 7"
                                                    fill="none"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                  >
                                                    <path d="M1.5 3.5L2.83333 4.75L4.16667 6L9.5 1"
                                                      stroke="currentColor"
                                                      stroke-width="1.75"
                                                      stroke-linecap="round"
                                                      stroke-linejoin="round" />
                                                  </svg>
                                                {% endif %}
                
                                                {% comment %} <span class="facet-checkbox__text" aria-hidden="true">
                                                  {{- value.label | escape }} ({{ value.count }})</span
                                                > {% endcomment %}
                                                <span class="facet-checkbox__text" aria-hidden="true">
                                                  {% comment %} {{- value.label | replace: '_', ' ' | escape }} {% endcomment %}
                                                  {{- value.label | split: ': ' | last | escape }}
                                                  
                                                  </span
                                                >
                                                <span class="visually-hidden">
                                                  {% comment %} {{- value.label | replace: '_', ' ' | escape }} {% endcomment %}
                                                  {{- value.label | split: ': ' | last | escape }}
                                                  (
                                                  {%- if value.count == 1 -%}
                                                    {{- 'products.facets.product_count_simple.one' | t: count: value.count -}}
                                                  {%- else -%}
                                                    {{- 'products.facets.product_count_simple.other' | t: count: value.count -}}
                                                  {%- endif -%}
                                                  )</span
                                                >
                                              </label>
                                            </li>
                                          {% endif %}

                                          {% comment %} {% endif %} {% endcomment %}
                                          {%- endfor -%}
                                        </ul>
                                        <ul
                                          class="{% if filter_type != 'vertical' %} facets__list{% endif %} no-js-list list-unstyled no-js"
                                          role="list"
                                        >
                                          {%- for value in filter.values -%}
                                            <li class="list-menu__item facets__item ">
                                              <label
                                                for="Filter-{{ filter.param_name | escape }}-{{ forloop.index }}-no-js"
                                                class="facet-checkbox{% if value.count == 0 and value.active == false %} facet-checkbox--disabled{% endif %}"
                                              >
                                                <input
                                                  type="checkbox"
                                                  name="{{ value.param_name }}"
                                                  value="{{ value.value }}"
                                                  id="Filter-{{ filter.param_name | escape }}-{{ forloop.index }}-no-js"
                                                  {% if value.active %}
                                                    checked
                                                  {% endif %}
                                                  {% if value.count == 0 and value.active == false %}
                                                    disabled
                                                  {% endif %}
                                                >
                
                                                <svg
                                                  width="1.6rem"
                                                  height="1.6rem"
                                                  viewBox="0 0 14 14"
                                                  aria-hidden="true"
                                                  class="checkbox_input_svg"
                                                  focusable="false"
                                                >
                                                  <rect width="14" height="14" stroke="currentColor" fill="none" stroke-width="1"></rect>
                                                </svg>
                
                                                <svg
                                                  aria-hidden="true"
                                                  class="icon icon-checkmark"
                                                  width="1.1rem"
                                                  height="0.7rem"
                                                  viewBox="0 0 11 7"
                                                  fill="none"
                                                  xmlns="http://www.w3.org/2000/svg"
                                                >
                                                  <path d="M1.5 3.5L2.83333 4.75L4.16667 6L9.5 1"
                                                    stroke="currentColor"
                                                    stroke-width="1.75"
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round" />
                                                </svg>
                
                                                <span aria-hidden="true">{{ value.label | escape }} ({{ value.count }})</span>
                                                <span class="visually-hidden">
                                                  {{- value.label | escape }} (
                                                  {%- if value.count == 1 -%}
                                                    {{- 'products.facets.product_count_simple.one' | t: count: value.count -}}
                                                  {%- else -%}
                                                    {{- 'products.facets.product_count_simple.other' | t: count: value.count -}}
                                                  {%- endif -%}
                                                  )</span
                                                >
                                              </label>
                                            </li>
                                          {%- endfor -%}
                                        </ul>
                                      </fieldset>
                                      {% if current_count > 10 %}
                                        <show-more-button>
                                          <button
                                            class="button-show-more link underlined-link no-js-hidden"
                                            id="Show-More-{{ forloop.index }}-{{ section.id }}"
                                            type="button"
                                          >
                                            <span aria-hidden="true" class="label-show-more label-text"
                                              >{{ 'products.facets.show_more' | t -}}
                                            </span>
                                            <span  aria-hidden="true" class="label-show-less label-text hidden"
                                              >{{ 'products.facets.show_less' | t -}}
                                            </span>
                                          </button>
                                        </show-more-button>
                                      {%- endif %}
                                    </div>
                                </details>
                              {% endif %}
                            {% endif %}

                          {%- endfor -%}
                        {% endif %}

                          {% comment %} Stock Filter {% endcomment %}
                          {% assign checkbox_filter = false %}
                          {%- for filter in collection.filters -%}
                            {%- for filter_value in filter.active_values -%}
                              {% if filter_value.label == "In stock" %}
                                {% assign checkbox_filter = true %}
                              {% endif %}
                            {% endfor %}
                          {% endfor %}
                    
                  
                      
              {% endcase %}
            {%- endfor -%}

            <div class="facets__disclosure-vertical facets__disclosure-vertical_stock">
              <div class="facets-vertical-form">
                <div class="collection-filter__item-stock-toggle-button filter_stock_wrap">
                  <input type="checkbox" id="Filter-Availability-2" name="filter.v.availability" value="0" class="hide" {% comment %}{% if checkbox_filter == true %}checked{% endif %}{% endcomment %} style="display: none;">
                  <label for="Filter-Availability-2" class="collection-filter__item-stock-toggle facet-checkbox"></label><span class="collection-filter__item-stock-toggle-text">In Stock</span>
                </div>
              </div>
            </div>

            <noscript>
              <button type="submit" class="facets__button-no-js button button--secondary">
                {{ 'products.facets.filter_button' | t }}
              </button>
            </noscript>
          </div>

          {% comment %} Pills after filtes on filter type horizontal {% endcomment %}
          {%- if filter_type == 'horizontal' -%}
            <div class="active-facets active-facets-desktop">
              {%- for filter in results.filters -%}
                {%- for value in filter.active_values -%}
                  <facet-remove>
                    <a href="{{ value.url_to_remove }}" class="active-facets__button active-facets__button--light">
                      <span class="active-facets__button-inner button button--tertiary">
                        {{ filter.label | escape }}: {{ value.label | escape }}
                        {% render 'icon-close-small' %}
                        <span class="visually-hidden">{{ 'products.facets.clear_filter' | t }}</span>
                      </span>
                    </a>
                  </facet-remove>
                {%- endfor -%}
                {% if filter.type == 'price_range' %}
                  {%- if filter.min_value.value != null or filter.max_value.value != null -%}
                    <facet-remove>
                      <a href="{{ filter.url_to_remove }}" class="active-facets__button active-facets__button--light">
                        <span class="active-facets__button-inner button button--tertiary">
                          {%- if filter.min_value.value -%}
                            {{ filter.min_value.value | money }}
                          {%- else -%}
                            {{ 0 | money }}
                          {%- endif -%}
                          -
                          {%- if filter.max_value.value -%}
                            {{ filter.max_value.value | money }}
                          {%- else -%}
                            {{ filter.range_max | money }}
                          {%- endif -%}
                          {% render 'icon-close-small' %}
                          <span class="visually-hidden">{{ 'products.facets.clear_filter' | t }}</span>
                        </span>
                      </a>
                    </facet-remove>
                  {%- endif -%}
                {% endif %}
              {%- endfor -%}
              <facet-remove class="active-facets__button-wrapper">
                <a href="{{ results_url }}" class="active-facets__button-remove underlined-link">
                  <span>{{ 'products.facets.clear_all' | t }}</span>
                </a>
              </facet-remove>
            </div>
          {%- endif -%}
        {% endif %}

        {% if results.current_vendor or results.current_type %}
          <input type="hidden" name="q" value="{{ results.current_vendor }}{{ results.current_type }}">
        {% endif %}

        {%- if filter_type == 'horizontal' -%}
          {% comment %} Sorting and product count are the last elements when filter type is horizontal {% endcomment %}
          {%- if enable_sorting -%}
            <div class="facet-filters sorting caption">
              <div class="facet-filters__field">
                <h2 class="facet-filters__label caption-large text-body">
                  <label for="SortBy">{{ 'products.facets.sort_by_label' | t }}</label>
                </h2>
                <div class="select">
                  {%- assign sort_by = results.sort_by | default: results.default_sort_by -%}
                  <select
                    name="sort_by"
                    class="facet-filters__sort select__select caption-large"
                    id="SortBy"
                    aria-describedby="a11y-refresh-page-message"
                  >
                    {%- for option in results.sort_options -%}
                      <option
                        value="{{ option.value | escape }}"
                        {% if option.value == sort_by %}
                          selected="selected"
                        {% endif %}
                      >
                        {{ option.name | escape }}
                      </option>
                    {%- endfor -%}
                  </select>
                  {% render 'icon-caret' %}
                </div>
              </div>

              <noscript>
                <button type="submit" class="facets__button-no-js button button--secondary">
                  {{ 'products.facets.sort_button' | t }}
                </button>
              </noscript>
            </div>
          {%- endif -%}
          <div class="product-count light" role="status">
            <h2 class="product-count__text text-body">
              <span id="ProductCountDesktop">
                {%- if results.results_count -%}
                  {{ 'templates.search.results_with_count' | t: terms: results.terms, count: results.results_count }}
                {%- elsif results.products_count == results.all_products_count -%}
                  {{ 'products.facets.product_count_simple' | t: count: results.products_count }}
                {%- else -%}
                  {{
                    'products.facets.product_count'
                    | t: product_count: results.products_count, count: results.all_products_count
                  }}
                {%- endif -%}
              </span>
            </h2>
            {%- render 'loading-spinner' -%}
          </div>
        {%- endif -%}
          {% comment %} live chat icon {% endcomment %}
        {%- if section.settings.live_chat_checkbox != blank -%}
          {% comment %} <a onclick="GorgiasChat.open();" href="javascript:void(0);" class="livechat-gorgias-content"></a> {% endcomment %}
          <div class="block__live_chat_section">
              <a onclick="GorgiasChat.open();" href="javascript:void(0);" class="livechat-gorgias-content">
                <span class="block__live_chat_inner">
                    <span class="block_live_chat_icon">
                      {% render 'icon_live_chat' %}
                    </span>
                    <span class="block_live_chat_info">
                        <span class="block__live_chat_subheading small_body">{{section.settings.live_chat_subtext}}</span>
                        <span class="block__live_chat_heading medium_body">{{ section.settings.live_chat_text  }}</span>
                    </span>
                </span> 
              </a>
          </div>
        {%- endif -%} 
      </form>
    </facet-filters-form>
    {% comment %} Sorting for vertical filter are grouped with filter when no JS{% endcomment %}
    {%- if enable_sorting and filter_type == 'vertical' -%}
      <facet-filters-form class="small-hide">
        <form class="no-js">
          <div class="facet-filters sorting caption">
            <div class="facet-filters__field">
              <h2 class="facet-filters__label caption-large text-body">
                <label for="SortBy">{{ 'products.facets.sort_by_label' | t }}</label>
              </h2>
              <div class="select">
                {%- assign sort_by = results.sort_by | default: results.default_sort_by -%}
                <select
                  name="sort_by"
                  class="facet-filters__sort select__select caption-large"
                  id="SortBy"
                  aria-describedby="a11y-refresh-page-message"
                >
                  {%- for option in results.sort_options -%}
                    <option
                      value="{{ option.value | escape }}"
                      {% if option.value == sort_by %}
                        selected="selected"
                      {% endif %}
                    >
                      {{ option.name | escape }}
                    </option>
                  {%- endfor -%}
                </select>
                {% render 'icon-caret' %}
              </div>
            </div>

            <noscript>
              <button type="submit" class="facets__button-no-js button button--secondary">
                {{ 'products.facets.sort_button' | t }}
              </button>
            </noscript>
          </div>

          {% if results.current_vendor or results.current_type %}
            <input type="hidden" name="q" value="{{ results.current_vendor }}{{ results.current_type }}">
          {% endif %}

          {%- if results.terms -%}
            <input type="hidden" name="q" value="{{ results.terms | escape }}">
            <input name="options[prefix]" type="hidden" value="last">
          {%- endif -%}
        </form>
      </facet-filters-form>
    {%- endif -%}
  {%- endif -%}
  {% comment %}  Drawer and mobile filter {% endcomment %}

  {%- if enable_filtering -%}
  <menu-drawer
    class="mobile-facets__wrapper{% if filter_type == 'horizontal' or filter_type == 'vertical' %} medium-hide large-up-hide{% endif %} {% if collection.metafields.custom.collection_banner_image_checkbox != blank %} collection-content-mobile-facets__wrapper {% endif %}"
    data-breakpoint="mobile">
    <details class="mobile-facets__disclosure disclosure-has-popup">
      <summary class="mobile-facets__open-wrapper focus-offset">
        {% if collection.metafields.custom.collection_banner_image_checkbox != blank %}
          <span class="mobile-facets__open{% if filter_type == 'drawer' and enable_filtering == false %} medium-hide large-up-hide{% endif %} {% if collection.metafields.custom.collection_banner_image_checkbox != blank %} collection-content-mobile-facets {% endif %} ">
            {% comment %} {% render 'icon-filter' %} {% endcomment %}
            

            <span class="mobile-facets__open-label button-label medium-hide large-up-hide">
              {%- if enable_filtering and enable_sorting -%}
                {{ 'products.facets.filter_and_sort-by' | t }}
              {%- elsif enable_filtering -%}
                {{ 'products.facets.filter_button' | t }}
              {%- elsif enable_sorting -%}
                {{ 'products.facets.sort_button' | t }}
              {%- endif -%}
            </span>
            
            <span class="mobile-facets__open-label button-label small-hide">
              {%- if enable_filtering -%}
                {{ 'products.facets.filter_button' | t }}
              {%- endif -%}
            </span>
            <svg  class="icon icon-filter" width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0 1.23438C0 0.953125 0.09375 0.71875 0.28125 0.53125C0.46875 0.34375 0.703125 0.25 0.984375 0.25H11.0156C11.2969 0.25 11.5312 0.34375 11.7188 0.53125C11.9062 0.71875 12 0.953125 12 1.23438C12 1.46875 11.9297 1.67188 11.7891 1.84375L7.875 6.64844V10C7.875 10.2031 7.80469 10.3828 7.66406 10.5391C7.50781 10.6797 7.32812 10.75 7.125 10.75C6.9375 10.75 6.78125 10.6875 6.65625 10.5625L4.47656 8.875C4.24219 8.67188 4.125 8.42188 4.125 8.125V6.64844L0.210938 1.84375C0.0703125 1.67188 0 1.46875 0 1.23438ZM1.28906 1.375L5.13281 6.08594C5.21094 6.19531 5.25 6.3125 5.25 6.4375V8.03125L6.75 9.22656V6.4375C6.75 6.3125 6.78906 6.19531 6.86719 6.08594L10.7109 1.375H1.28906Z" fill="black" fill-opacity="0.8"/>
            </svg>
          </span>

          {% else %}
          <span class="mobile-facets__open{% if filter_type == 'drawer' and enable_filtering == false %} medium-hide large-up-hide{% endif %}">
            {% render 'icon-filter' %}
            <span class="mobile-facets__open-label button-label medium-hide large-up-hide">
              {%- if enable_filtering and enable_sorting -%}
                {{ 'products.facets.filter_and_sort' | t }}
              {%- elsif enable_filtering -%}
                {{ 'products.facets.filter_button' | t }}
              {%- elsif enable_sorting -%}
                {{ 'products.facets.sort_button' | t }}
              {%- endif -%}
            </span>
            <span class="mobile-facets__open-label button-label small-hide">
              {%- if enable_filtering -%}
                {{ 'products.facets.filter_button' | t }}
              {%- endif -%}
            </span>
          </span>
        {% endif %}
        <span tabindex="0" class="mobile-facets__close mobile-facets__close--no-js">{%- render 'icon-close' -%}</span>
      </summary>
      <facet-filters-form>
        <form id="FacetFiltersFormMobile" class="mobile-facets">
          <div class="mobile-facets__inner gradient">
            <div class="mobile-facets__header">
              {% if collection.metafields.custom.collection_banner_image_checkbox != blank %}
              <div class="mobile-facets__header-inner">
                <h2 class="mobile-facets__heading medium-hide large-up-hide">
                  {%- if enable_filtering and enable_sorting -%}
                    {{ 'products.facets.filter_and_sort-by' | t }}
                  {%- elsif enable_filtering -%}
                    {{ 'products.facets.filter_button' | t }}
                  {%- elsif enable_sorting -%}
                    {{ 'products.facets.sort_button' | t }}
                  {%- endif -%}
                </h2>
                <h2 class="mobile-facets__heading small-hide">
                  {%- if enable_filtering -%}
                    {{ 'products.facets.filter_button' | t }}
                  {%- endif -%}
                </h2>
              </div>
          {% else %}
              <div class="mobile-facets__header-inner">
                <h2 class="mobile-facets__heading medium-hide large-up-hide">
                  {%- if enable_filtering and enable_sorting -%}
                    {{ 'products.facets.filter_and_sort' | t }}
                  {%- elsif enable_filtering -%}
                    {{ 'products.facets.filter_button' | t }}
                  {%- elsif enable_sorting -%}
                    {{ 'products.facets.sort_button' | t }}
                  {%- endif -%}
                </h2>
                <h2 class="mobile-facets__heading small-hide">
                  {%- if enable_filtering -%}
                    {{ 'products.facets.filter_button' | t }}
                  {%- endif -%}
                </h2>
              </div>
                {% endif %}

            </div>
            <div
              id="FacetsWrapperMobile"
              class="mobile-facets__main has-submenu gradient abc" 
            >
              {%- if enable_filtering -%}

                {%- for filter in results.filters -%}
                  {% liquid
                    case filter.presentation
                      when 'swatch'
                        assign has_visual_display = true
                        assign visual_layout_class = 'facets-layout-grid facets-layout-grid--' | append: filter.presentation
                      else
                        assign has_visual_display = false
                        assign visual_layout_class = 'facets-layout-list'
                    endcase
                  %}

                  {% case filter.type %}
                    {% when 'boolean', 'list' %}

                      {% assign filter_paramval = filter.param_name | handle %}
                      {% if filter_paramval == 'filter-p-tag' or filter_paramval == 'filter-p-tags' %}
                        {%- assign custom_filter_labels = section.settings.filter_custom_labels | split: ',' -%}
                        {% for label in custom_filter_labels %}
                          {%- assign current_count = 0 -%} 
                       {%- for value in filter.values -%}
                              {% comment %} {% assign filterval = value.value  %}
                              {% assign label = label | strip %} {% endcomment %}
                              {% assign filterval = value.value |  handleize  %}
                              {% assign label_handle = label | strip  | handleize  %}
                              {% if filterval contains label_handle %}
                                {% assign current_count = custom_filter_labels | plus: 1  %}
                              {% endif %}
                       {%- endfor -%}





                       
                       {% if current_count > 0  %}
                        {% if  filterval != blank %}
                          <details
                          id="Details-Mobile-{{ filter.param_name | escape }}-{{ section.id }}-{{ label | handle }}"
                          class="mobile-facets__details ddd filter2_{{ label | handle }} js-filter"
                          data-index="mobile-{{ forloop.index }}-{{ label | handle }}"
                        >
                          <summary class="mobile-facets__summary focus-inset">
                            <div>
                              <span> {{ label | split: '_' | last | escape }}</span>
                              <span class="mobile-facets__arrow no-js-hidden">{% render 'icon-arrow' %}</span>
                              <noscript>{% render 'icon-caret' %}</noscript>
                            </div>
                          </summary>
                          <div
                            id="FacetMobile-{{ forloop.index }}-{{ section.id }}"
                            class="mobile-facets__submenu gradient"
                          >
                            <button
                              class="mobile-facets__close-button link link--text focus-inset"
                              aria-expanded="true"
                              type="button"
                            >
                              {% render 'icon-arrow' %}
                              <span> {{ label | split: '_' | last | escape }}</span>
                              {%- if filter.operator == 'AND' -%}
                                <span class="facets__and-helptext">
                                  {{ 'products.facets.filter_and_operator_subtitle' | t }}
                                </span>
                              {%- endif -%}
                            </button>
                            <ul class="{{ visual_layout_class }} mobile-facets__list list-unstyled" role="list">
                              {%- liquid
                                assign sorted_values = filter.values
                                # Keep the selected values grouped together when operator is AND
                                if filter.operator == 'AND'
                                  assign active_filter_values = filter.values | where: 'active', true
                                  assign inactive_filter_values = filter.values | where: 'active', false
                                  assign sorted_values = active_filter_values | concat: inactive_filter_values
                                endif
                              -%}
                              {% assign current_count-tag = 0 %}
                              {%- for value in sorted_values -%}
                                {% liquid
                                  assign is_disabled = false
                                  if value.count == 0 and value.active == false
                                    assign is_disabled = true
                                  endif
                                %}
                                {% comment %} {% assign filterval = value.value %} {% endcomment %}
                                {% assign filterval = value.value |  handleize  %}
                                {% assign label_handle = label | strip  | handleize  %}
                                {% if filterval contains label_handle  %}
                                  {% assign current_count-tag = current_count-tag | plus: 1 %}
                                    <li class="mobile-facets__item list-menu__item">
                                      <label
                                        for="Filter-{{ filter.param_name | escape }}-mobile-{{ forloop.index }}"
                                        class="facets__label mobile-facets__label{% if is_disabled %} mobile-facets__label--disabled disabled{% endif %}{% if has_visual_display %} visual-display-parent visual-display-parent--{{ filter.presentation }}{% endif %}{% if value.active %} active{% endif %}"
                                      >
                                        <input
                                          class="mobile-facets__checkbox"
                                          type="checkbox"
                                          name="{{ value.param_name }}"
                                          value="{{ value.value }}"
                                          id="Filter-{{ filter.param_name | escape }}-mobile-{{ forloop.index }}"
                                          {% if value.active %}
                                            checked
                                          {% endif %}
                                          {% if is_disabled %}
                                            disabled
                                          {% endif %}
                                        >

                                        {% if has_visual_display %}
                                          <div class="facets__visual-display-wrapper">
                                            {% render 'visual-display',
                                              type: value.display.type,
                                              value: value.display.value,
                                              presentation: filter.presentation
                                            %}
                                          </div>
                                        {% else %}
                                          <span class="mobile-facets__highlight"></span>

                                          <svg
                                            width="1.6rem"
                                            height="1.6rem"
                                            viewBox="0 0 16 16"
                                            aria-hidden="true"
                                            focusable="false"
                                          >
                                            <rect width="16" height="16" stroke="currentColor" fill="none" stroke-width="1"></rect>
                                          </svg>

                                          <svg
                                            aria-hidden="true"
                                            class="icon icon-checkmark"
                                            width="1.1rem"
                                            height="0.7rem"
                                            viewBox="0 0 11 7"
                                            fill="none"
                                            xmlns="http://www.w3.org/2000/svg"
                                          >
                                            <path d="M1.5 3.5L2.83333 4.75L4.16667 6L9.5 1" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" />
                                          </svg>
                                        {% endif %}

                                        <span class="facet-checkbox__text" aria-hidden="true">
                                          {% comment %} {{- value.label | replace: '_', ' ' | escape }} {% endcomment %}
                                          {{- value.label | split: ': ' | last | escape }}
                                           ({{ value.count }})</span
                                        >
                                        <span class="visually-hidden">
                                          {% comment %} {{- value.label | replace: '_', ' ' | escape }}  {% endcomment %}
                                          {{- value.label | split: ': ' | last | escape }}
                                          (
                                          {%- if value.count == '1' -%}
                                            {{- 'products.facets.product_count_simple.one' | t: count: value.count -}}
                                          {%- else -%}
                                            {{- 'products.facets.product_count_simple.other' | t: count: value.count -}}
                                          {%- endif -%}
                                          )</span
                                        >
                                      </label>
                                    </li>
                                  {% endif %}
                              {%- endfor -%}
                            </ul>

                            <div class="no-js-hidden mobile-facets__footer gradient">
                              <facet-remove class="mobile-facets__clear-wrapper">
                                <a href="{{ filter.url_to_remove }}" class="mobile-facets__clear underlined-link custom_btn border_btn">
                                  {{- 'products.facets.clear' | t -}}
                                </a>
                              </facet-remove>
                              <button
                                type="button"
                                class="no-js-hidden button button--primary custom_btn black_btn"
                                onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()"
                              >
                                {{ 'products.facets.apply' | t }}
                              </button>
                              <noscript
                                ><button class="button button--primary">
                                  {{ 'products.facets.apply' | t }}
                                </button></noscript
                              >
                            </div>
                          </div>
                        </details>
                            {% endif %}
                       {% endif %}
                      {% endfor %}


                        {% assign checkbox_filter = false %}
                        {%- for filter in collection.filters -%}
                          {%- for filter_value in filter.active_values -%}
                            {% if filter_value.label == "In stock" %}
                              {% assign checkbox_filter = true %}
                            {% endif %}
                          {% endfor %}
                        {% endfor %}

                        <div class="facets__disclosure-vertical facets__disclosure-vertical_stock mobile-facets__details">
                          <div class="facets-vertical-form">
                            <div class="collection-filter__item-stock-toggle-button filter_stock_wrap">
                              <input type="checkbox" id="Filter-Availability-mobile_2" name="filter.v.availability" value="0" class="hide" {% comment %}{% if checkbox_filter == true %}checked{% endif %}{% endcomment %} style="display: none;">
                              <label for="Filter-Availability-mobile_2" class="collection-filter__item-stock-toggle facet-checkbox"></label><span class="collection-filter__item-stock-toggle-text">In Stock</span>
                            </div>
                          </div>
                        </div>
                  
                  {% endif %}

                  {% endcase %}
                {%- endfor -%}
              {%- endif -%}

              <div class="mobile-facets__footer">
                <facet-remove class="mobile-facets__clear-wrapper">
                  <a href="{{ results_url }}" class="mobile-facets__clear underlined-link custom_btn border_btn ">
                    {{- 'products.facets.clear_all' | t -}}
                  </a>
                </facet-remove>
                <button
                  type="button"
                  class="no-js-hidden button button--primary custom_btn black_btn"
                  onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()"
                >
                  {{ 'products.facets.apply' | t }}
                </button>
                <noscript
                  ><button class="button button--primary">{{ 'products.facets.apply' | t }}</button></noscript
                >
              </div>
            </div>

            {% if results.current_vendor or results.current_type %}
              <input type="hidden" name="q" value="{{ results.current_vendor }}{{ results.current_type }}">
            {% endif %}

            {%- if results.terms -%}
              <input type="hidden" name="q" value="{{ results.terms | escape }}">
              <input name="options[prefix]" type="hidden" value="last">
            {%- endif -%}
          </div>
        </form>
      </facet-filters-form>
    </details>
  </menu-drawer>
  {%- endif -%}

  {% if collection.metafields.custom.collection_banner_image_checkbox != blank %}
    {%- if enable_sorting -%}
      <div
        id="Details-Mobile-SortBy-{{ section.id }}"
        class="mobile-facets__details js-filter{% if filter_type == 'horizontal' or filter_type == 'vertical' %} medium-hide large-up-hide{% endif %}  {% if collection.metafields.custom.collection_banner_image_checkbox != blank %} collection-content-mobile-facets__details {% endif %}"
        data-index="mobile-{{ forloop.index }}"
      >
        <div class="mobile-facets__summary">
          <div class="mobile-facets__sort">
            <label for="SortBy-mobile">{{ 'products.facets.sort_by_label' | t }}</label>
            <div class="select">
              <select
                name="sort_by"
                class="select__select"
                id="SortBy-mobile"
                aria-describedby="a11y-refresh-page-message"
              >
                {%- for option in results.sort_options -%}
                  {% unless option.value contains 'created-ascending' or option.value contains 'created-descending'  %}
                    <option
                      value="{{ option.value | escape }}"
                      {% if option.value == sort_by %}
                        selected="selected"
                      {% endif %}
                    >
                      {{ option.name | escape }}
                    </option>
                  {% endunless %}
                {%- endfor -%}
              </select>
              {% render 'icon-caret' %}
              {% comment %} <svg width="16" height="16" class="icon icon-sort" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6.66667 12H9.33333V10.6667H6.66667V12ZM2 4V5.33333H14V4H2ZM4 8.66667H12V7.33333H4V8.66667Z" fill="#12138D"/>
              </svg> {% endcomment %}
            </div>
          </div>
        </div>
      </div>
    {%- endif -%}
    {% else %}
  <menu-drawer
    class="mobile-facets__wrapper mobile-sortfacets__wrapper{% if filter_type == 'horizontal' or filter_type == 'vertical' %} medium-hide large-up-hide{% endif %}"
    data-breakpoint="mobile">
    <details class="mobile-facets__disclosure disclosure-has-popup">
      <summary class="mobile-facets__open-wrapper focus-offset">
        <span class="mobile-facets__open{% if filter_type == 'drawer' and enable_filtering == false %} medium-hide large-up-hide{% endif %}">
          
          <span class="mobile-facets__open-label button-label medium-hide large-up-hide">
            {%- if enable_sorting -%}
              {{ 'products.facets.sort_button' | t }}
            {%- endif -%}
          </span>
        </span>
        <span tabindex="0" class="mobile-facets__close mobile-facets__close--no-js">{%- render 'icon-close' -%}</span>
      </summary>
      <facet-filters-form>
        <form id="FacetFiltersFormMobile" class="mobile-facets">
          <div class="mobile-facets__inner gradient">
            <div class="mobile-facets__header">
              <div class="mobile-facets__header-inner">
                <h2 class="mobile-facets__heading medium-hide large-up-hide">
                  {%- if enable_sorting -%}
                    {{ 'products.facets.sort_button' | t }}
                  {%- endif -%}
                </h2>
              </div>
            </div>
            <div
              id="FacetsWrapperMobile"
              class="mobile-facets__main has-submenu gradient">

              {%- if enable_sorting -%}
                <div
                  id="Details-Mobile-SortBy-{{ section.id }}"
                  class="mobile-facets__details js-filter{% if filter_type == 'drawer' %} medium-hide large-up-hide{% endif %}"
                  data-index="mobile-{{ forloop.index }}"
                >
                  <div class="mobile-facets__summary">
                    <div class="mobile-facets__sort">
                      <label for="SortBy-mobile">{{ 'products.facets.sort_by_label' | t }}</label>
                      <div class="select">
                        <select
                          name="sort_by"
                          class="select__select"
                          id="SortBy-mobile"
                          aria-describedby="a11y-refresh-page-message"
                        >
                          {%- for option in results.sort_options -%}
                            {% unless option.value contains 'created-ascending' or option.value contains 'created-descending'  %}
                              <option
                                value="{{ option.value | escape }}"
                                {% if option.value == sort_by %}
                                  selected="selected"
                                {% endif %}
                              >
                                {{ option.name | escape }}
                              </option>
                            {% endunless %}
                          {%- endfor -%}
                        </select>
                        {% comment %} {% render 'icon-caret' %} {% endcomment %}
                        <svg width="16" height="16" class="icon icon-sort" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M6.66667 12H9.33333V10.6667H6.66667V12ZM2 4V5.33333H14V4H2ZM4 8.66667H12V7.33333H4V8.66667Z" fill="#12138D"/>
                        </svg>
                      </div>
                    </div>
                  </div>
                </div>
              {%- endif -%}

              <div class="mobile-facets__footer">
                <facet-remove class="mobile-facets__clear-wrapper">
                  <a href="{{ results_url }}" class="mobile-facets__clear underlined-link custom_btn border_btn">
                    {{- 'products.facets.clear_all' | t -}}
                  </a>
                </facet-remove>
                <button
                  type="button"
                  class="no-js-hidden button button--primary custom_btn black_btn"
                  onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()"
                >
                  {{ 'products.facets.apply' | t }}
                </button>
                <noscript
                  ><button class="button button--primary">{{ 'products.facets.apply' | t }}</button></noscript
                >
              </div>
            </div>

          </div>
        </form>
      </facet-filters-form>
    </details>
  </menu-drawer>
  {% endif %}

  {% comment %} Sort, product count and filter pills at the end when filter is type of Drawer for the correct tabbing order {% endcomment %}
  {%- if enable_sorting and filter_type == 'drawer' -%}
    <facet-filters-form class="facets small-hide">
      <form id="FacetSortDrawerForm" class="facets__form">
        <div class="facet-filters sorting caption small-hide">
          <div class="facet-filters__field">
            <h2 class="facet-filters__label caption-large text-body">
              <label for="SortBy">{{ 'products.facets.sort_by_label' | t }}</label>
            </h2>
            <div class="select">
              {%- assign sort_by = results.sort_by | default: results.default_sort_by -%}
              <select
                name="sort_by"
                class="facet-filters__sort select__select caption-large"
                id="SortBy"
                aria-describedby="a11y-refresh-page-message"
              >
                {%- for option in results.sort_options -%}
                  <option
                    value="{{ option.value | escape }}"
                    {% if option.value == sort_by %}
                      selected="selected"
                    {% endif %}
                  >
                    {{ option.name | escape }}
                  </option>
                {%- endfor -%}
              </select>
              {% render 'icon-caret' %}
            </div>
          </div>

          <noscript>
            <button type="submit" class="facets__button-no-js button button--secondary">
              {{ 'products.facets.sort_button' | t }}
            </button>
          </noscript>
        </div>

        {% if results.current_vendor or results.current_type %}
          <input type="hidden" name="q" value="{{ results.current_vendor }}{{ results.current_type }}">
        {% endif %}

        {%- if results.terms -%}
          <input type="hidden" name="q" value="{{ results.terms | escape }}">
          <input name="options[prefix]" type="hidden" value="last">
        {%- endif -%}
      </form>
    </facet-filters-form>
  {%- endif -%}
  <div
    class="product-count hidden light{% if filter_type == 'vertical' or filter_type == 'horizontal' %} medium-hide large-up-hide{% endif %}"
    role="status"
  >
    <h2 class="product-count__text text-body">
      <span id="ProductCount">
        {%- if results.results_count -%}
          {{ 'templates.search.results_with_count' | t: terms: results.terms, count: results.results_count }}
        {%- elsif results.products_count == results.all_products_count -%}
          {{ 'products.facets.product_count_simple' | t: count: results.products_count }}
        {%- else -%}
          {{
            'products.facets.product_count'
            | t: product_count: results.products_count, count: results.all_products_count
          }}
        {%- endif -%}
      </span>
    </h2>
    {%- render 'loading-spinner' -%}
  </div>
  {%- if filter_type == 'drawer' -%}
    <facet-filters-form class="facets facets-pill small-hide">
      <form id="FacetFiltersPillsForm" class="facets__form">
        <div class="active-facets active-facets-desktop">
          {%- for filter in results.filters -%}
            {%- for value in filter.active_values -%}
              <facet-remove>
                <a href="{{ value.url_to_remove }}" class="active-facets__button active-facets__button--light">
                  <span class="active-facets__button-inner button button--tertiary">
                    {{ filter.label | escape }}: {{ value.label | escape }}
                    {% render 'icon-close-small' %}
                    <span class="visually-hidden">{{ 'products.facets.clear_filter' | t }}</span>
                  </span>
                </a>
              </facet-remove>
            {%- endfor -%}

            {%- if filter.type == 'price_range' -%}
              {%- if filter.min_value.value != null or filter.max_value.value != null -%}
                <facet-remove>
                  <a href="{{ filter.url_to_remove }}" class="active-facets__button active-facets__button--light">
                    <span class="active-facets__button-inner button button--tertiary">
                      {%- if filter.min_value.value -%}
                        {{ filter.min_value.value | money }}
                      {%- else -%}
                        {{ 0 | money }}
                      {%- endif -%}
                      -
                      {%- if filter.max_value.value -%}
                        {{ filter.max_value.value | money }}
                      {%- else -%}
                        {{ filter.range_max | money }}
                      {%- endif -%}
                      {% render 'icon-close-small' %}
                      <span class="visually-hidden">{{ 'products.facets.clear_filter' | t }}</span>
                    </span>
                  </a>
                </facet-remove>
              {%- endif -%}
            {%- endif -%}
          {%- endfor -%}
          <facet-remove class="active-facets__button-wrapper">
            <a href="{{ results_url }}" class="active-facets__button-remove underlined-link">
              <span>{{ 'products.facets.clear_all' | t }}</span>
            </a>
          </facet-remove>
        </div>
      </form>
    </facet-filters-form>
  {%- endif -%}
</div>

{% unless collection.metafields.custom.collection_banner_image_checkbox  %}
<div class="collection-filter-mobile-viewicons medium-hide large-up-hide">
  <span class="collection-result-count">{%- if collection.results_count -%}
    {{
      'templates.search.results_with_count'
      | t: terms: collection.terms, count: collection.results_count
    }}
  {%- elsif collection.products_count == collection.all_products_count -%}
    {{ 'products.facets.product_count_simple' | t: count: collection.products_count }}
  {%- else -%}
    {{
      'products.facets.product_count'
      | t: product_count: collection.products_count, count: collection.all_products_count
    }}
  {%- endif -%}</span>
  <div class="facets-product-viewcontent" style="display:none">
      <div class="facets-product-viewitem facets-product-view-grid-3 active-grid" data-gridcolumn="3">
        {%  render 'icon-grid-2' %}
      </div>
      <div class="facets-product-viewitem facets-product-view-grid-2" data-gridcolumn="2">
        {%  render 'icon-mobile-grid-2' %}
      </div>
      <div class="facets-product-viewitem facets-product-view-list" data-gridcolumn="1">
        {%  render 'icon-listview' %}
      </div>
    </div>
</div>
{% endunless %}

<div class="active-facets active-facets-mobile medium-hide large-up-hide">
  {%- for filter in results.filters -%}
    {%- for value in filter.active_values -%}
      <facet-remove>
        <a href="{{ value.url_to_remove }}" class="active-facets__button active-facets__button--light">
          <span class="active-facets__button-inner button button--tertiary">
            {{ filter.label | escape }}: {{ value.label | escape }}
            {% render 'icon-close-small' %}
            <span class="visually-hidden">{{ 'products.facets.clear_filter' | t }}</span>
          </span>
        </a>
      </facet-remove>
    {%- endfor -%}

    {%- if filter.type == 'price_range' -%}
      {%- if filter.min_value.value != null or filter.max_value.value != null -%}
        <facet-remove>
          <a href="{{ filter.url_to_remove }}" class="active-facets__button active-facets__button--light">
            <span class="active-facets__button-inner button button--tertiary">
              {%- if filter.min_value.value -%}
                {{ filter.min_value.value | money }}
              {%- else -%}
                {{ 0 | money }}
              {%- endif -%}
              -
              {%- if filter.max_value.value -%}
                {{ filter.max_value.value | money }}
              {%- else -%}
                {{ filter.range_max | money }}
              {%- endif -%}
              {% render 'icon-close-small' %}
              <span class="visually-hidden">{{ 'products.facets.clear_filter' | t }}</span>
            </span>
          </a>
        </facet-remove>
      {%- endif -%}
    {%- endif -%}
  {%- endfor -%}
  <facet-remove class="active-facets__button-wrapper">
    <a href="{{ results_url }}" class="active-facets__button-remove underlined-link">
      <span>{{ 'products.facets.clear_all' | t }}</span>
    </a>
  </facet-remove>
</div>



